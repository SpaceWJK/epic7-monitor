name: Epic7 Debug Simple
on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
    
    - name: Test environment
      env:
        DISCORD_WEBHOOK_BUG: ${{ secrets.DISCORD_WEBHOOK_BUG }}
      run: |
        echo "=== í™˜ê²½ë³€ìˆ˜ í…ŒìŠ¤íŠ¸ ==="
        python -c "import os; print('Discord ì›¹í›…:', 'Yes' if os.environ.get('DISCORD_WEBHOOK_BUG') else 'No')"
        
        echo "=== ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ==="
        python -c "
        try:
            from crawler import crawl_arca_sites
            from classifier import is_bug_post
            from notifier import send_bug_alert
            print('ëª¨ë“  ëª¨ë“ˆ import ì„±ê³µ')
        except Exception as e:
            print(f'ëª¨ë“ˆ import ì‹¤íŒ¨: {e}')
        "
        
        echo "=== ë¶„ë¥˜ê¸° í…ŒìŠ¤íŠ¸ ==="
        python -c "
        from classifier import is_bug_post, classify_post
        test_titles = ['ë²„ê·¸ ë°œìƒ', 'ì¢‹ì€ ì—…ë°ì´íŠ¸', 'ì¼ë°˜ ê²Œì‹œê¸€']
        for title in test_titles:
            print(f'{title} -> {classify_post(title)}')
        "
    
    - name: Discord test
      env:
        DISCORD_WEBHOOK_BUG: ${{ secrets.DISCORD_WEBHOOK_BUG }}
      run: |
        echo "=== Discord ì›¹í›… í…ŒìŠ¤íŠ¸ ==="
        python -c "
        import os
        from notifier import send_bug_alert
        webhook_url = os.environ.get('DISCORD_WEBHOOK_BUG')
        if webhook_url:
            test_alerts = [{
                'title': 'ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼',
                'url': 'https://test.com',
                'timestamp': '2025-01-01T00:00:00',
                'source': 'stove_bug'
            }]
            send_bug_alert(webhook_url, test_alerts)
            print('í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ')
        else:
            print('Discord ì›¹í›…ì´ ì„¤ì •ë˜ì§€ ì•ŠìŒ')
        "
