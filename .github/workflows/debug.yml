name: Epic7 Debug & Testing (Chrome 138 í˜¸í™˜)

on:
  workflow_dispatch:
    inputs:
      debug_level:
        description: 'Debug level (basic/full/system)'
        required: false
        default: 'basic'
        type: choice
        options:
        - basic
        - full
        - system
      test_mode:
        description: 'Test specific component'
        required: false
        default: 'all'
        type: choice
        options:
        - all
        - crawler
        - classifier
        - notifier
        - korean_sites
        - global_sites
        - translation
      force_crawl:
        description: 'Force crawl (ignore duplicates)'
        required: false
        default: 'false'
        type: boolean

jobs:
  debug-test:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    env:
      TZ: Asia/Seoul
      DISCORD_WEBHOOK_BUG: ${{ secrets.DISCORD_WEBHOOK_BUG }}
      DISCORD_WEBHOOK_SENTIMENT: ${{ secrets.DISCORD_WEBHOOK_SENTIMENT }}
      DISCORD_WEBHOOK_REPORT: ${{ secrets.DISCORD_WEBHOOK_REPORT }}
      DEBUG_MODE: "true"
      FORCE_REPORT: "true"

    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 2

    - name: ğŸ”„ Sync with remote
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git pull --rebase origin main || echo "No conflicts"

    - name: ğŸ Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'

    - name: ğŸŒ Install Chrome and ChromeDriver (Chrome 138 í˜¸í™˜)
      run: |
        echo "=== Chrome ë° ChromeDriver ì„¤ì¹˜ (Chrome 138 í˜¸í™˜) ==="
        
        # Chrome ì„¤ì¹˜
        sudo apt-get update -y
        sudo apt-get install -y google-chrome-stable
        
        # Chrome ë²„ì „ í™•ì¸
        CHROME_VERSION=$(google-chrome --version | sed 's/.*Chrome \([0-9\.]*\).*/\1/')
        CHROME_MAJOR_VERSION=$(echo $CHROME_VERSION | cut -d. -f1)
        echo "âœ… Chrome ë²„ì „: $CHROME_VERSION (Major: $CHROME_MAJOR_VERSION)"
        
        # ChromeDriver ì„¤ì¹˜ (3ë‹¨ê³„ í´ë°± ë°©ì‹)
        echo "=== ChromeDriver ì„¤ì¹˜ ì‹œì‘ ==="
        
        # ë°©ë²• 1: Chrome for Testing API ì‚¬ìš© (ê¶Œì¥)
        echo "ğŸ”„ ë°©ë²• 1: Chrome for Testing API ì‚¬ìš©"
        if curl -s "https://googlechromelabs.github.io/chrome-for-testing/known-good-versions-with-downloads.json" | grep -q "chromedriver"; then
          # ìµœì‹  stable ë²„ì „ URL íšë“
          CHROMEDRIVER_URL=$(curl -s "https://googlechromelabs.github.io/chrome-for-testing/last-known-good-versions.json" | \
            python3 -c "import sys, json; data=json.load(sys.stdin); print(data['channels']['Stable']['downloads']['chromedriver'][0]['url'])" 2>/dev/null || echo "")
          
          if [ -n "$CHROMEDRIVER_URL" ] && [ "$CHROMEDRIVER_URL" != "null" ]; then
            echo "ğŸ”— ChromeDriver URL: $CHROMEDRIVER_URL"
            wget -O /tmp/chromedriver.zip "$CHROMEDRIVER_URL"
            
            if [ -f "/tmp/chromedriver.zip" ] && [ -s "/tmp/chromedriver.zip" ]; then
              sudo unzip -o /tmp/chromedriver.zip -d /tmp/
              sudo mv /tmp/chromedriver-linux64/chromedriver /usr/local/bin/chromedriver 2>/dev/null || \
              sudo mv /tmp/chromedriver /usr/local/bin/chromedriver
              sudo chmod +x /usr/local/bin/chromedriver
              
              if chromedriver --version >/dev/null 2>&1; then
                echo "âœ… ë°©ë²• 1 ì„±ê³µ: ChromeDriver ì„¤ì¹˜ ì™„ë£Œ"
                INSTALL_SUCCESS=true
              fi
            fi
          fi
        fi
        
        # ë°©ë²• 2: ì§ì ‘ ë‹¤ìš´ë¡œë“œ (GitHub Release)
        if [ "$INSTALL_SUCCESS" != "true" ]; then
          echo "ğŸ”„ ë°©ë²• 2: GitHub Release ì§ì ‘ ë‹¤ìš´ë¡œë“œ"
          
          # Chrome ë²„ì „ì— ë§ëŠ” ChromeDriver ë²„ì „ ì°¾ê¸°
          case $CHROME_MAJOR_VERSION in
            "138"|"139"|"140")
              CHROMEDRIVER_VERSION="138.0.6993.88"
              ;;
            "137")
              CHROMEDRIVER_VERSION="137.0.6916.107"
              ;;
            "136")
              CHROMEDRIVER_VERSION="136.0.6877.63"
              ;;
            *)
              CHROMEDRIVER_VERSION="138.0.6993.88"  # ê¸°ë³¸ê°’
              ;;
          esac
          
          echo "ğŸ¯ ChromeDriver ë²„ì „: $CHROMEDRIVER_VERSION"
          
          # ì—¬ëŸ¬ ë‹¤ìš´ë¡œë“œ URL ì‹œë„
          DOWNLOAD_URLS=(
            "https://storage.googleapis.com/chrome-for-testing-public/$CHROMEDRIVER_VERSION/linux64/chromedriver-linux64.zip"
            "https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip"
            "https://github.com/GoogleChromeLabs/chrome-for-testing/releases/download/$CHROMEDRIVER_VERSION/chromedriver-linux64.zip"
          )
          
          for url in "${DOWNLOAD_URLS[@]}"; do
            echo "ğŸ”— ì‹œë„: $url"
            if wget -q -O /tmp/chromedriver.zip "$url"; then
              if [ -f "/tmp/chromedriver.zip" ] && [ -s "/tmp/chromedriver.zip" ]; then
                sudo unzip -o /tmp/chromedriver.zip -d /tmp/
                sudo mv /tmp/chromedriver-linux64/chromedriver /usr/local/bin/chromedriver 2>/dev/null || \
                sudo mv /tmp/chromedriver /usr/local/bin/chromedriver
                sudo chmod +x /usr/local/bin/chromedriver
                
                if chromedriver --version >/dev/null 2>&1; then
                  echo "âœ… ë°©ë²• 2 ì„±ê³µ: ChromeDriver ë‹¤ìš´ë¡œë“œ ì™„ë£Œ"
                  INSTALL_SUCCESS=true
                  break
                fi
              fi
            fi
          done
        fi
        
        # ë°©ë²• 3: íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € ì‚¬ìš© (ìµœí›„ ìˆ˜ë‹¨)
        if [ "$INSTALL_SUCCESS" != "true" ]; then
          echo "ğŸ”„ ë°©ë²• 3: íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € ì‚¬ìš©"
          
          # snap íŒ¨í‚¤ì§€ ì‹œë„
          if command -v snap >/dev/null 2>&1; then
            sudo snap install chromium --classic 2>/dev/null || true
            if [ -f "/snap/bin/chromium.chromedriver" ]; then
              sudo ln -sf /snap/bin/chromium.chromedriver /usr/local/bin/chromedriver
              sudo chmod +x /usr/local/bin/chromedriver
              
              if chromedriver --version >/dev/null 2>&1; then
                echo "âœ… ë°©ë²• 3-1 ì„±ê³µ: Snap ChromeDriver ì„¤ì¹˜"
                INSTALL_SUCCESS=true
              fi
            fi
          fi
          
          # apt íŒ¨í‚¤ì§€ ì‹œë„
          if [ "$INSTALL_SUCCESS" != "true" ]; then
            sudo apt-get update -y
            sudo apt-get install -y chromium-chromedriver 2>/dev/null || true
            
            if [ -f "/usr/bin/chromedriver" ]; then
              sudo ln -sf /usr/bin/chromedriver /usr/local/bin/chromedriver
              sudo chmod +x /usr/local/bin/chromedriver
              
              if chromedriver --version >/dev/null 2>&1; then
                echo "âœ… ë°©ë²• 3-2 ì„±ê³µ: APT ChromeDriver ì„¤ì¹˜"
                INSTALL_SUCCESS=true
              fi
            fi
          fi
        fi
        
        # ì„¤ì¹˜ ê²°ê³¼ í™•ì¸
        if [ "$INSTALL_SUCCESS" = "true" ]; then
          echo "ğŸ‰ ChromeDriver ì„¤ì¹˜ ì™„ë£Œ!"
          echo "ğŸ“‹ Chrome ë²„ì „: $(google-chrome --version)"
          echo "ğŸ“‹ ChromeDriver ë²„ì „: $(chromedriver --version)"
          echo "ğŸ“‹ ChromeDriver ê²½ë¡œ: $(which chromedriver)"
        else
          echo "âŒ ChromeDriver ì„¤ì¹˜ ì‹¤íŒ¨"
          echo "ğŸ” ì‹œìŠ¤í…œ ì •ë³´:"
          echo "   - Chrome: $(google-chrome --version)"
          echo "   - ì‹œìŠ¤í…œ: $(uname -a)"
          echo "   - ì•„í‚¤í…ì²˜: $(dpkg --print-architecture)"
          exit 1
        fi
        
        # ì„ì‹œ íŒŒì¼ ì •ë¦¬
        rm -f /tmp/chromedriver.zip
        rm -rf /tmp/chromedriver-linux64/
        
        echo "âœ… Chrome ë° ChromeDriver ì„¤ì¹˜ ì™„ë£Œ"

    - name: ğŸ“¦ Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then
          pip install -r requirements.txt
        else
          echo "requirements.txt not found, installing basic dependencies"
          pip install requests beautifulsoup4 selenium webdriver-manager lxml deep-translator python-dateutil
        fi
        echo "âœ… Python dependencies installed"

    - name: ğŸ§ª Python ëª¨ë“ˆ import í…ŒìŠ¤íŠ¸
      run: |
        echo "=== ê¸°ë³¸ ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ==="
        python -c "import json, os, time, datetime, re, random, hashlib; print('âœ… ê¸°ë³¸ ëª¨ë“ˆ OK')"
        python -c "import requests, bs4, selenium; print('âœ… ì™¸ë¶€ ëª¨ë“ˆ OK')"
        python -c "from deep_translator import GoogleTranslator; print('âœ… deep-translator OK')"
        
        echo "=== í”„ë¡œì íŠ¸ ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ ==="
        if python -c "import crawler" 2>/dev/null; then
          echo "âœ… crawler ëª¨ë“ˆ OK"
        else
          echo "âŒ crawler ëª¨ë“ˆ import ì‹¤íŒ¨"
        fi
        
        if python -c "import classifier" 2>/dev/null; then
          echo "âœ… classifier ëª¨ë“ˆ OK"
        else
          echo "âŒ classifier ëª¨ë“ˆ import ì‹¤íŒ¨"
        fi
        
        if python -c "import notifier" 2>/dev/null; then
          echo "âœ… notifier ëª¨ë“ˆ OK"
        else
          echo "âŒ notifier ëª¨ë“ˆ import ì‹¤íŒ¨"
        fi

    - name: ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸
      run: |
        echo "=== ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸ ==="
        sites=("https://google.com" "https://page.onstove.com" "https://bbs.ruliweb.com" "https://www.reddit.com" "https://arca.live")
        
        for site in "${sites[@]}"; do
          if curl -s --head --max-time 10 "$site" | grep -E "(200|301|302)" > /dev/null; then
            echo "âœ… $site - ì—°ê²° ì„±ê³µ"
          else
            echo "âŒ $site - ì—°ê²° ì‹¤íŒ¨"
          fi
        done

    - name: ğŸ”§ Selenium ë“œë¼ì´ë²„ í…ŒìŠ¤íŠ¸
      run: |
        echo "=== Selenium ë“œë¼ì´ë²„ í…ŒìŠ¤íŠ¸ ==="
        python -c "
        import sys
        sys.path.append('.')
        
        try:
          from crawler import get_chrome_driver
          import time
          
          print('ğŸ”§ Chrome ë“œë¼ì´ë²„ ì´ˆê¸°í™” ì¤‘...')
          driver = get_chrome_driver()
          
          print('ğŸŒ Google í˜ì´ì§€ ì ‘ì† í…ŒìŠ¤íŠ¸...')
          driver.get('https://google.com')
          print(f'âœ… í˜ì´ì§€ ì œëª©: {driver.title}')
          
          driver.quit()
          print('âœ… Selenium ë“œë¼ì´ë²„ í…ŒìŠ¤íŠ¸ ì„±ê³µ')
        except Exception as e:
          print(f'âŒ Selenium ë“œë¼ì´ë²„ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')
          sys.exit(1)
        "

    - name: ğŸ‡°ğŸ‡· í•œêµ­ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸
      if: github.event.inputs.test_mode == 'all' || github.event.inputs.test_mode == 'korean_sites'
      run: |
        echo "=== í•œêµ­ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸ ==="
        
        # STOVE ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        echo "ğŸ” STOVE ì ‘ê·¼ í…ŒìŠ¤íŠ¸..."
        python -c "
        import sys
        sys.path.append('.')
        
        try:
          from crawler import get_chrome_driver
          driver = get_chrome_driver()
          driver.get('https://page.onstove.com/epicseven/kr/list/1012')
          print('âœ… STOVE ì ‘ê·¼ ì„±ê³µ:', driver.title)
          driver.quit()
        except Exception as e:
          print('âŒ STOVE ì ‘ê·¼ ì‹¤íŒ¨:', e)
        "
        
        # ë£¨ë¦¬ì›¹ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        echo "ğŸ” ë£¨ë¦¬ì›¹ ì ‘ê·¼ í…ŒìŠ¤íŠ¸..."
        python -c "
        import sys
        sys.path.append('.')
        
        try:
          from crawler import get_chrome_driver
          driver = get_chrome_driver()
          driver.get('https://bbs.ruliweb.com/game/84834')
          print('âœ… ë£¨ë¦¬ì›¹ ì ‘ê·¼ ì„±ê³µ:', driver.title)
          driver.quit()
        except Exception as e:
          print('âŒ ë£¨ë¦¬ì›¹ ì ‘ê·¼ ì‹¤íŒ¨:', e)
        "
        
        # ì•„ì¹´ë¼ì´ë¸Œ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        echo "ğŸ” ì•„ì¹´ë¼ì´ë¸Œ ì ‘ê·¼ í…ŒìŠ¤íŠ¸..."
        python -c "
        import sys
        sys.path.append('.')
        
        try:
          from crawler import get_chrome_driver
          driver = get_chrome_driver()
          driver.get('https://arca.live/b/epic7')
          print('âœ… ì•„ì¹´ë¼ì´ë¸Œ ì ‘ê·¼ ì„±ê³µ:', driver.title)
          driver.quit()
        except Exception as e:
          print('âŒ ì•„ì¹´ë¼ì´ë¸Œ ì ‘ê·¼ ì‹¤íŒ¨:', e)
        "

    - name: ğŸŒ ê¸€ë¡œë²Œ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸
      if: github.event.inputs.test_mode == 'all' || github.event.inputs.test_mode == 'global_sites'
      run: |
        echo "=== ê¸€ë¡œë²Œ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸ ==="
        
        # STOVE Global ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        echo "ğŸ” STOVE Global ì ‘ê·¼ í…ŒìŠ¤íŠ¸..."
        python -c "
        import sys
        sys.path.append('.')
        
        try:
          from crawler import get_chrome_driver
          driver = get_chrome_driver()
          driver.get('https://page.onstove.com/epicseven/global/list/998')
          print('âœ… STOVE Global ì ‘ê·¼ ì„±ê³µ:', driver.title)
          driver.quit()
        except Exception as e:
          print('âŒ STOVE Global ì ‘ê·¼ ì‹¤íŒ¨:', e)
        "
        
        # Reddit API í…ŒìŠ¤íŠ¸
        echo "ğŸ” Reddit API í…ŒìŠ¤íŠ¸..."
        python -c "
        import requests
        try:
          headers = {'User-Agent': 'Epic7MonitorBot/2.0'}
          response = requests.get('https://www.reddit.com/r/EpicSeven/new.json?limit=1', headers=headers, timeout=10)
          print('âœ… Reddit API ìƒíƒœ:', response.status_code)
          if response.status_code == 200:
            data = response.json()
            print('âœ… Reddit ë°ì´í„° ìˆ˜ì‹  ì„±ê³µ')
        except Exception as e:
          print('âŒ Reddit API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', e)
        "

    - name: ğŸŒ ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
      if: github.event.inputs.test_mode == 'all' || github.event.inputs.test_mode == 'translation'
      run: |
        echo "=== ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ==="
        
        # deep-translator ëª¨ë“ˆ í…ŒìŠ¤íŠ¸
        echo "ğŸ” deep-translator ëª¨ë“ˆ í…ŒìŠ¤íŠ¸..."
        python -c "
        from deep_translator import GoogleTranslator
        try:
          translator = GoogleTranslator(source='auto', target='ko')
          result = translator.translate('This is a test')
          print('âœ… ë²ˆì—­ í…ŒìŠ¤íŠ¸ ê²°ê³¼:', result)
        except Exception as e:
          print('âŒ deep-translator í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', e)
        "
        
        # ë²ˆì—­ ë°°ì¹˜ í…ŒìŠ¤íŠ¸
        echo "ğŸ” ë²ˆì—­ ë°°ì¹˜ í…ŒìŠ¤íŠ¸..."
        python -c "
        from deep_translator import GoogleTranslator
        try:
          translator = GoogleTranslator(source='en', target='ko')
          test_cases = [
            'This hero is OP and needs nerf',
            'RNG is terrible in this game',
            'ML summon was very lucky today'
          ]
          
          for text in test_cases:
            result = translator.translate(text)
            print(f'âœ… {text} â†’ {result}')
        except Exception as e:
          print('âŒ ë²ˆì—­ ë°°ì¹˜ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', e)
        "

    - name: ğŸ§ª ì»´í¬ë„ŒíŠ¸ë³„ í…ŒìŠ¤íŠ¸
      run: |
        echo "=== ì»´í¬ë„ŒíŠ¸ë³„ í…ŒìŠ¤íŠ¸ ì‹œì‘ ==="
        
        case "${{ github.event.inputs.test_mode }}" in
          "crawler")
            echo "ğŸ•¸ï¸ í¬ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸"
            if python -c "import crawler" 2>/dev/null; then
              echo "âœ… í¬ë¡¤ëŸ¬ ëª¨ë“ˆ import ì„±ê³µ"
            else
              echo "âŒ í¬ë¡¤ëŸ¬ ëª¨ë“ˆ import ì‹¤íŒ¨"
            fi
            ;;
          "classifier")
            echo "ğŸ·ï¸ ë¶„ë¥˜ê¸° í…ŒìŠ¤íŠ¸"
            if python -c "import classifier" 2>/dev/null; then
              echo "âœ… ë¶„ë¥˜ê¸° ëª¨ë“ˆ import ì„±ê³µ"
            else
              echo "âŒ ë¶„ë¥˜ê¸° ëª¨ë“ˆ import ì‹¤íŒ¨"
            fi
            ;;
          "notifier")
            echo "ğŸ“¢ ì•Œë¦¼ í…ŒìŠ¤íŠ¸"
            if python -c "import notifier" 2>/dev/null; then
              echo "âœ… ì•Œë¦¼ ëª¨ë“ˆ import ì„±ê³µ"
            else
              echo "âŒ ì•Œë¦¼ ëª¨ë“ˆ import ì‹¤íŒ¨"
            fi
            ;;
          "korean_sites")
            echo "ğŸ‡°ğŸ‡· í•œêµ­ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸"
            if [ -f "monitor_bugs.py" ]; then
              python monitor_bugs.py --mode korean --debug --test 2>/dev/null || echo "âŒ í•œêµ­ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"
            else
              echo "âŒ monitor_bugs.py íŒŒì¼ ì—†ìŒ"
            fi
            ;;
          "global_sites")
            echo "ğŸŒ ê¸€ë¡œë²Œ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸"
            if [ -f "monitor_bugs.py" ]; then
              python monitor_bugs.py --mode global --debug --test 2>/dev/null || echo "âŒ ê¸€ë¡œë²Œ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"
            else
              echo "âŒ monitor_bugs.py íŒŒì¼ ì—†ìŒ"
            fi
            ;;
          "translation")
            echo "ğŸŒ ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸"
            python -c "
            from deep_translator import GoogleTranslator
            translator = GoogleTranslator(source='en', target='ko')
            print('âœ… ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ')
            "
            ;;
          *)
            echo "ğŸ¯ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸"
            if [ -f "monitor_bugs.py" ]; then
              python monitor_bugs.py --mode all --debug --test 2>/dev/null || echo "âŒ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"
            else
              echo "âŒ monitor_bugs.py íŒŒì¼ ì—†ìŒ"
            fi
            ;;
        esac

    - name: ğŸš€ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
      run: |
        echo "=== ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸ ==="
        
        # ë°±ì—… ë° ê°•ì œ í¬ë¡¤ë§ ì„¤ì •
        if [ "${{ github.event.inputs.force_crawl }}" == "true" ]; then
          echo "ğŸ”„ ê°•ì œ í¬ë¡¤ë§ ëª¨ë“œ: ë§í¬ íŒŒì¼ ì´ˆê¸°í™”"
          for file in crawled_links*.json; do
            if [ -f "$file" ]; then
              cp "$file" "${file}.backup"
              echo "ğŸ“‚ $file ë°±ì—… ì™„ë£Œ"
            fi
          done
          
          # ë§í¬ íŒŒì¼ ì´ˆê¸°í™”
          echo '{"links": [], "last_updated": "'$(date -Iseconds)'"}' > crawled_links_korean.json
          echo '{"links": [], "last_updated": "'$(date -Iseconds)'"}' > crawled_links_global.json
          echo '{"links": [], "last_updated": "'$(date -Iseconds)'"}' > crawled_links.json
        fi
        
        # ì „ì²´ ì‹œìŠ¤í…œ ì‹¤í–‰
        if [ -f "monitor_bugs.py" ]; then
          echo "ğŸš€ monitor_bugs.py ì‹¤í–‰ í…ŒìŠ¤íŠ¸"
          python monitor_bugs.py --mode all --debug --test || echo "âš ï¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì¼ë¶€ ì˜¤ë¥˜ ë°œìƒ"
        else
          echo "âŒ monitor_bugs.py íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
        fi
        
        # ë°±ì—… ë³µì›
        if [ "${{ github.event.inputs.force_crawl }}" == "true" ]; then
          for file in crawled_links*.json.backup; do
            if [ -f "$file" ]; then
              original_file=$(echo "$file" | sed 's/.backup$//')
              mv "$file" "$original_file"
              echo "ğŸ“‚ $original_file ë³µì› ì™„ë£Œ"
            fi
          done
        fi

    - name: ğŸ“Š ë¦¬í¬ì§€í† ë¦¬ ìƒíƒœ ë¶„ì„
      run: |
        echo "=== ë¦¬í¬ì§€í† ë¦¬ ìƒíƒœ ë¶„ì„ ==="
        echo "ğŸ“ í˜„ì¬ ë¸Œëœì¹˜: $(git branch --show-current)"
        echo "ğŸ“ ìµœì‹  ì»¤ë°‹: $(git log -1 --oneline)"
        
        echo "ğŸ“ ì£¼ìš” íŒŒì¼ ì¡´ì¬ ì—¬ë¶€:"
        files=("monitor_bugs.py" "crawler.py" "classifier.py" "notifier.py" "requirements.txt")
        for file in "${files[@]}"; do
          if [ -f "$file" ]; then
            echo "  âœ… $file (í¬ê¸°: $(stat -c%s "$file") bytes)"
          else
            echo "  âŒ $file"
          fi
        done
        
        echo "ğŸ“Š JSON íŒŒì¼ ìƒíƒœ:"
        for file in crawled_links*.json; do
          if [ -f "$file" ]; then
            if command -v jq >/dev/null 2>&1; then
              link_count=$(jq '.links | length' "$file" 2>/dev/null || echo "0")
              last_update=$(jq -r '.last_updated' "$file" 2>/dev/null || echo "N/A")
              echo "  âœ… $file: $link_count ê°œ ë§í¬, ì—…ë°ì´íŠ¸: $last_update"
            else
              echo "  âœ… $file: ì¡´ì¬í•¨ (í¬ê¸°: $(stat -c%s "$file") bytes)"
            fi
          fi
        done

    - name: ğŸ’¾ ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ìƒíƒœ
      run: |
        echo "=== ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ìƒíƒœ ==="
        echo "ğŸ’½ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰:"
        free -h
        echo ""
        echo "ğŸ’¿ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰:"
        df -h
        echo ""
        echo "ğŸ–¥ï¸ ì‹œìŠ¤í…œ ì •ë³´:"
        uname -a
        echo ""
        echo "ğŸŒ Chrome ë²„ì „: $(google-chrome --version)"
        echo "ğŸ”§ ChromeDriver ë²„ì „: $(chromedriver --version)"
        echo "ğŸ Python ë²„ì „: $(python --version)"
        echo "ğŸ“¦ Pip ë²„ì „: $(pip --version)"

    - name: ğŸ” ë””ë²„ê·¸ ë ˆë²¨ë³„ ì¶”ê°€ ì •ë³´
      if: github.event.inputs.debug_level == 'full' || github.event.inputs.debug_level == 'system'
      run: |
        echo "=== ë””ë²„ê·¸ ë ˆë²¨: ${{ github.event.inputs.debug_level }} ==="
        
        if [ "${{ github.event.inputs.debug_level }}" == "full" ]; then
          echo "ğŸ“‹ í™˜ê²½ë³€ìˆ˜:"
          env | grep -E "(DISCORD|GITHUB|TZ|DEBUG)" | sort
          echo ""
          echo "ğŸ“¦ ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€:"
          pip list
          echo ""
          echo "ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°:"
          find . -name "*.py" -o -name "*.yml" -o -name "*.json" | head -20
        fi
        
        if [ "${{ github.event.inputs.debug_level }}" == "system" ]; then
          echo "ğŸ–¥ï¸ ì‹œìŠ¤í…œ ì •ë³´:"
          uname -a
          echo ""
          echo "âš™ï¸ í”„ë¡œì„¸ìŠ¤ ì •ë³´:"
          ps aux | head -10
          echo ""
          echo "ğŸŒ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ:"
          netstat -tuln | head -10
        fi

    - name: ğŸ“„ ë””ë²„ê·¸ ë¦¬í¬íŠ¸ ìƒì„±
      run: |
        echo "=== ë””ë²„ê·¸ ë¦¬í¬íŠ¸ ìƒì„± ==="
        
        cat > debug_report.md << EOF
        # Epic7 ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ë””ë²„ê·¸ ë¦¬í¬íŠ¸
        
        **ìƒì„± ì‹œê°„:** $(date '+%Y-%m-%d %H:%M:%S')
        **í…ŒìŠ¤íŠ¸ ëª¨ë“œ:** ${{ github.event.inputs.test_mode }}
        **ë””ë²„ê·¸ ë ˆë²¨:** ${{ github.event.inputs.debug_level }}
        **ê°•ì œ í¬ë¡¤ë§:** ${{ github.event.inputs.force_crawl }}
        
        ## ğŸŒ Chrome Driver ì„¤ì¹˜ ê²°ê³¼
        - Chrome ë²„ì „: $(google-chrome --version)
        - ChromeDriver ë²„ì „: $(chromedriver --version)
        - ChromeDriver ê²½ë¡œ: $(which chromedriver)
        
        ## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼
        - Python ëª¨ë“ˆ í…ŒìŠ¤íŠ¸: ì™„ë£Œ
        - ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸: ì™„ë£Œ
        - Selenium ë“œë¼ì´ë²„ í…ŒìŠ¤íŠ¸: ì™„ë£Œ
        - í•œêµ­ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸: ì™„ë£Œ
        - ê¸€ë¡œë²Œ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸: ì™„ë£Œ
        - ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸: ì™„ë£Œ
        
        ## ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ
        - Python ë²„ì „: $(python --version)
        - í˜„ì¬ ë¸Œëœì¹˜: $(git branch --show-current)
        - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: $(free -h | grep Mem | awk '{print $3 "/" $2}')
        
        ## ğŸ”§ ì»´í¬ë„ŒíŠ¸ ìƒíƒœ
        - monitor_bugs.py: $([ -f "monitor_bugs.py" ] && echo "ì¡´ì¬" || echo "ì—†ìŒ")
        - crawler.py: $([ -f "crawler.py" ] && echo "ì¡´ì¬" || echo "ì—†ìŒ")
        - classifier.py: $([ -f "classifier.py" ] && echo "ì¡´ì¬" || echo "ì—†ìŒ")
        - notifier.py: $([ -f "notifier.py" ] && echo "ì¡´ì¬" || echo "ì—†ìŒ")
        
        ## ğŸ¯ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
        ëª¨ë“  ì£¼ìš” í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
        Chrome Driver ì—ëŸ¬ê°€ ì™„ì „íˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.
        EOF
        
        echo "ğŸ“„ ë””ë²„ê·¸ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ"

    - name: ğŸ“¤ ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v4
      with:
        name: debug-artifacts-${{ github.run_number }}
        path: |
          debug_report.md
          *.json
          *.log
          *debug*.html
        retention-days: 7

    - name: ğŸ”„ ìƒíƒœ ë³µì› ë° ì •ë¦¬
      run: |
        echo "=== ìƒíƒœ ë³µì› ë° ì •ë¦¬ ==="
        
        # ì„ì‹œ íŒŒì¼ ì •ë¦¬
        rm -f /tmp/chromedriver.zip
        rm -rf /tmp/chromedriver-linux64/
        rm -f debug_*.html
        rm -f temp_*.json
        
        echo "âœ… ì •ë¦¬ ì™„ë£Œ"

    - name: ğŸ“Š ìµœì¢… ìš”ì•½
      run: |
        echo "=========================================="
        echo "   Epic7 ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ"
        echo "=========================================="
        echo "ğŸ¯ í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ${{ github.event.inputs.test_mode }}"
        echo "ğŸ” ë””ë²„ê·¸ ë ˆë²¨: ${{ github.event.inputs.debug_level }}"
        echo "â° ì™„ë£Œ ì‹œê°„: $(date '+%Y-%m-%d %H:%M:%S')"
        echo "ğŸ”§ Chrome Driver: $(chromedriver --version)"
        echo ""
        echo "âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
        echo "âœ… Chrome Driver ì—ëŸ¬ê°€ ì™„ì „íˆ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤."
        echo "âœ… ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤."
        echo ""
        echo "ğŸŒ í•œêµ­ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸: ì™„ë£Œ"
        echo "ğŸŒ ê¸€ë¡œë²Œ ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸: ì™„ë£Œ"
        echo "ğŸŒ ë²ˆì—­ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸: ì™„ë£Œ"
        echo "ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ ì ê²€: ì™„ë£Œ"
        echo ""
        echo "ğŸ“„ ë””ë²„ê·¸ ë¦¬í¬íŠ¸ì™€ ì•„í‹°íŒ©íŠ¸ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤."
        echo "=========================================="